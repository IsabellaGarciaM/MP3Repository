<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reproductor de música</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
</head>
<body>
    <!-- Reproductor de audio oculto -->
    <audio id="music" preload="auto"></audio>
    
    <!-- Reproductor de video oculto -->
    <video id="video" preload="auto" crossorigin="anonymous" playsinline webkit-playsinline></video>

    <a-scene>
        <!-- Entidad de la cámara -->
        <a-entity position="0 2 5" look-controls>
            <a-camera>
                <!-- Cursor para la interacción -->
                <a-cursor color="pink"></a-cursor>
            </a-camera>
        </a-entity>

        <!-- Luces -->
        <a-light type="ambient" color="#FFF"></a-light>
        <a-light type="directional" position="-5 5 5" intensity="0.5"></a-light>

        <!-- Suelo -->
        <a-entity gltf-model="https://mayvisan.github.io/ProyectoTercerCorte/FloorEXPORT/FloorEXPORT.glb" position="0 0 0" scale="1 1 1"></a-entity>
        
        <!-- Otros elementos de la escena -->
        
        <!-- Parlantes -->
        <a-entity gltf-model="https://mayvisan.github.io/ProyectoTercerCorte/ParlantesEXPORT/ParlanteEXPORT.glb" position="0 0 0" scale="1 1 1"></a-entity>
        <!-- Audifonos -->
        <a-entity gltf-model="https://mayvisan.github.io/ProyectoTercerCorte/AudifonosEXPORT/AudifonosEXPORT.glb" position="0 0 0" scale="1 1 1"></a-entity>
        <!-- Persona TV -->
        <a-entity gltf-model="https://mayvisan.github.io/ProyectoTercerCorte/TV/scene.gltf" position="-4.019 4.669 1.082" rotation="0.000 -36.720 0.000" scale="0.036 0.036 0.036"></a-entity>
        <a-entity gltf-model="https://mayvisan.github.io/ProyectoTercerCorte/TV/scene.gltf" position="14.727 4.721 1.688" rotation="0.000 -152.162 0.000" scale="0.036 0.036 0.036"></a-entity>
        <!-- Papeles en el suelo -->
        <a-entity gltf-model="https://mayvisan.github.io/ProyectoTercerCorte/TVStack/scene.gltf" position="10.294 -0.043 7.331" rotation="0.000 -152.162 0.000" scale="0.445 0.445 0.445"></a-entity>
        <a-entity gltf-model="https://mayvisan.github.io/ProyectoTercerCorte/TVStack/scene.gltf" position="7.909 -0.043 1.308" rotation="0.000 -60.335 0.000" scale="0.445 0.445 0.445"></a-entity>
        <a-entity gltf-model="https://mayvisan.github.io/ProyectoTercerCorte/TVStack/scene.gltf" position="2.206 -0.043 6.27454" rotation="0 -60.335 0" scale="0.445 0.44463 0.44463"></a-entity>
        <a-entity gltf-model="https://mayvisan.github.io/ProyectoTercerCorte/TVStack/scene.gltf" position="-3.22886 -0.043 1.0296" rotation="0 35.1526796046614 0" scale="0.445 0.44463 0.44463"></a-entity>
        <a-entity gltf-model="https://mayvisan.github.io/ProyectoTercerCorte/TVStack/scene.gltf" position="13.86248 -0.043 -1.94402" rotation="0 35.1526796046614 0" scale="0.445 0.44463 0.44463"></a-entity>
        <a-entity gltf-model="https://mayvisan.github.io/ProyectoTercerCorte/TVStack/scene.gltf" position="-0.53725 -0.043 -3.19633" rotation="0 35.1526796046614 0" scale="0.445 0.44463 0.44463"></a-entity>
        <a-entity gltf-model="https://mayvisan.github.io/ProyectoTercerCorte/TVStack/scene.gltf" position="-4.7901 -0.043 8.07706" rotation="0 35.1526796046614 0" scale="0.445 0.44463 0.44463"></a-entity>
        <a-entity gltf-model="https://mayvisan.github.io/ProyectoTercerCorte/TVStack/scene.gltf" position="3.57541 -0.043 -2.82669" rotation="0 35.1526796046614 0" scale="0.445 0.44463 0.44463"></a-entity>

        <!-- iPod -->
        <a-entity id="button-prev" gltf-model="https://mayvisan.github.io/ProyectoTercerCorte/BackButtonEXPORT/BackButtonEXPORT.glb" position="3.447 0.059 -4.911" scale="0.328 0.328 0.328" previous-button></a-entity>
        <a-entity id="button-next" gltf-model="https://mayvisan.github.io/ProyectoTercerCorte/FowardButtonEXPORT/FowardButtonEXPORT.glb" position="6.583 0 -4.695" scale="0.328 0.328 0.328" next-button></a-entity>
        <a-entity id="button-playpause" gltf-model="https://mayvisan.github.io/ProyectoTercerCorte/BotonPlayPauseEXPORT/BotonPlayPauseEXPORT.glb" position="0 0 0.1" scale="1 1 1" sound-handler></a-entity>
        <a-entity id="button-volup" gltf-model="https://mayvisan.github.io/ProyectoTercerCorte/BotonMasEXPORT/BotonMasEXPORT.glb" position="-3.580 -0.910 2.971" scale="1.689 1.689 1.689" volume-up></a-entity>
        <a-entity id="button-voldown" gltf-model="https://mayvisan.github.io/ProyectoTercerCorte/BotonMenosEXPORT/BotonMenosEXPORT.glb" position="-5.259 -1.742 4.766" scale="2.103 2.103 2.103" volume-down></a-entity>
        <a-entity gltf-model="https://mayvisan.github.io/ProyectoTercerCorte/IpodCirculitoEXPORT/IpodCirculitoEXPORT.glb" position="0 0 0" scale="1 1 1"></a-entity>
        <a-entity gltf-model="https://mayvisan.github.io/ProyectoTercerCorte/IpodEXPORT/IpodEXPORT.glb" position="0 0 0" scale="1 1 1"></a-entity>

        <!-- Texto para mostrar el título de la canción -->
        <a-text id="song-title" value="" color="#000" align="center" position="5 6.646 -4.630" scale="3 3 3"></a-text>
        
        <!-- Pantalla con video -->
        <a-entity gltf-model="https://mayvisan.github.io/ProyectoTercerCorte/PantallitaEXPORT/PantallitaEXPORT.glb" position="0 0 0" scale="1 1 1">
            <a-video src="#video" width="1.6" height="0.9" position="5.085 4.593 -4.557" scale="2.192 2.809 1.311"></a-video>
        </a-entity>

        <!-- Skybox opcional para el fondo -->
        <a-sky color="#f1b25b"></a-sky>
    </a-scene>

    <script>
        const playlist = [
            {
                music: 'https://github.com/Mayvisan/ProyectoTercerCorte/blob/main/HeartbeatHeartbreak_ShihokoHirata.mp3?raw=true',
                video: 'https://cdn.glitch.me/eea5faf2-5e12-4384-bcdd-3301844d224c/heartbeatheartbreakvid.mp4?v=1716495194451',
                title: 'Heartbeat Heartbreak'
            },
            {
                music: 'https://cdn.glitch.global/eea5faf2-5e12-4384-bcdd-3301844d224c/Dance_ShihokoHirata.mp3?v=1716508537573',
                video: 'https://cdn.glitch.me/eea5faf2-5e12-4384-bcdd-3301844d224c/DanceLyricVid.mp4?v=1716507153119',
                title: 'Dance'
            },
            {
                music: 'https://github.com/Mayvisan/ProyectoTercerCorte/blob/main/Pulltherigger.mp3?raw=true',
                video: 'https://cdn.glitch.me/eea5faf2-5e12-4384-bcdd-3301844d224c/Pullthetriggervid.mp4?v=1716508850728',
                title: 'Pull the trigger'
            },
            {
                music: 'https://github.com/Mayvisan/ProyectoTercerCorte/raw/main/BreakOutOf..._ShihokoHirata.mp3',
                video: 'https://cdn.glitch.me/eea5faf2-5e12-4384-bcdd-3301844d224c/Breakoutofvid.mp4?v=1716508246613',
                title: 'Break Out Of...'
            }
        ];
        let currentIndex = 0;

        const music = document.querySelector('#music');
        const video = document.querySelector('#video');
        const songTitle = document.querySelector('#song-title');

        function loadMedia(index) {
            music.src = playlist[index].music;
            video.src = playlist[index].video;
            songTitle.setAttribute('value', playlist[index].title); // Actualiza el título de la canción
            music.load();
            video.load();
        }

        function playNext() {
            currentIndex = (currentIndex + 1) % playlist.length;
            loadMedia(currentIndex);
            music.play();
            video.play();
        }

        // Event listeners para avanzar al siguiente elemento cuando termina la canción o el video
        music.addEventListener('ended', playNext);
        video.addEventListener('ended', playNext);
      
        AFRAME.registerComponent('sound-handler', {
            init: function () {
                var el = this.el;
                
                el.addEventListener('click', function () {
                    if (music.paused) {
                        music.play();
                        video.play();
                    } else {
                        music.pause();
                        video.pause();
                    }
                });
            }
        });

        AFRAME.registerComponent('volume-up', {
            init: function () {
                var el = this.el;
                
                el.addEventListener('click', function () {
                    music.volume = Math.min(music.volume + 0.1, 1); // Sube el volumen, hasta un máximo de 1
                });
            }
        });

        AFRAME.registerComponent('volume-down', {
            init: function () {
                var el = this.el;
                
                el.addEventListener('click', function () {
                    music.volume = Math.max(music.volume - 0.1, 0); // Baja el volumen, hasta un mínimo de 0
                });
            }
        });

        AFRAME.registerComponent('next-button', {
            init: function () {
                var el = this.el;
                
                el.addEventListener('click', function () {
                    playNext();
                });
            }
        });

        AFRAME.registerComponent('previous-button', {
            init: function () {
                var el = this.el;
                
                el.addEventListener('click', function () {
                    if (music.currentTime > 7) {
                        music.currentTime = 0;
                        video.currentTime = 0;
                        music.play();
                        video.play();
                    } else {
                        currentIndex = (currentIndex - 1 + playlist.length) % playlist.length;
                        loadMedia(currentIndex);
                        music.play();
                        video.play();
                    }
                });
            }
        });

        // Carga la primera canción y video al inicio
        loadMedia(currentIndex);
    </script>
</body>
</html>